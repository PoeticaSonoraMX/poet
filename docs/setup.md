# Setup

The server is currently running:
* [Debian][debian] as the OS
* [Nginx][nginx] for serving
* Python and PostgreSQL run with docker-compose for [Django][django]
* PHP and MySQL run with docker-compose for [Wordpress][wp]

[debian]: https://www.debian.org/
[nginx]: https://nginx.org/en/
[django]: https://www.djangoproject.com/
[wp]: https://wordpress.com/

If you find yourself needing to update PostgreSQL, I recommend [this tutorial][pg-tut].

[pg-tut]: https://www.pontikis.net/blog/update-postgres-major-version-in-debian

## Translation

In order to generate the Spanish language translation files:

```bash
python manage.py makemessages -l es -e j2,py -i bin -i lib
```

In order to compile the files:

```bash
python manage.py compilemessages
```

## Test data

A test fixture can be found under [app/fixtures/poet.json](app/fixtures/poet.json).
This was generated by the following command, and then pruned of most of the data:

```bash
python manage.py dumpdata --exclude auth --exclude contenttypes --exclude simple_histoy
```

Further documentation can be found on the [Django docs][1].

[1]: https://docs.djangoproject.com/en/3.2/ref/django-admin/#dumpdata

## Deployment

To deploy:

1. `ssh` onto the server
2. `cd` into the directory of the applications
3. Run `make`. This pulls from master and rebuilds the Docker image.

## Django in a subpath

The repository is installed at https://poeticasonora.unam.mx/rda, which is a subpath (/rda).
This requires [additional setup in Nginx][nginx-django-subpath].

[nginx-django-subpath]: https://newbedev.com/run-django-app-via-nginx-uwsgi-in-a-subpath
